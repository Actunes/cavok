<div class="container mt-4">
    <h2>List of Metar
        <button class="btn btn-primary btn-arrendondamento" (click)="openModal();form.reset()">
            <i class="fas fa-plus"></i>
            New Metar
        </button>
    </h2>
    <table *ngIf="metars.length > 0 && !loading" class="table table-striped table-hover">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Icao</th>
                <th scope="col">Day</th>
                <th scope="col">Hour</th>
                <th scope="col">Wind</th>
                <th scope="col">Infos</th>
                <th scope="col">Temp</th>
                <th scope="col">Dew Point</th>
                <th scope="col">Qnh</th>
                <th scope="col">Actions
                    <i class="fas fa-cog"></i>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let t of metars; let i = index">
                <th scope="row"> {{ i + 1 }} </th>
                <td> {{ t?.icao }} </td>
                <td> {{ t?.day | date: 'dd/MM/yyyy' }} </td>
                <td> {{ t?.hour }} </td>
                <td> {{ t?.wind }} </td>
                <td> {{ t?.infos }} </td>
                <td> {{ t?.temp }} </td>
                <td> {{ t?.dew_point }} </td>
                <td> {{ t?.qnh }} </td>
                <td>
                    <button class="btn btn-danger rounded-circle" (click)="deleteMetar(t.id ? t.id : 0)">
                        <i class="fas fa-trash-alt"></i>
                    </button>

                    - <button class="btn btn-warning rounded-circle" (click)="loadinDataMetar(t)">
                        <i class="fas fa-edit"></i>
                    </button>
                    - <button type="button" class="btn btn-primary rounded-circle" data-toggle="modal"
                        data-target="#metarModal" (click)="setCurrentMetar(t)">
                        <i class="fas fa-eye"></i>
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <div *ngIf="metars.length <= 0 && loading" class="d-flex justify-content-center">
        <i class="fas fa-spinner fa-spin fa-3x fa-fw"></i>
        <h3>Loading...</h3>
    </div>
</div>
<!-- MODAL DE CADASTRO/EDIÇÃO -->
<div class="modal" tabindex="-1" id="add-metar">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <ng-container *ngIf="form.value.id > 0; else novaTarefa">
                        Edit Metar
                    </ng-container>
                    <ng-template #novaTarefa>
                        Add Metar
                    </ng-template>
                </h5>

            </div>
            <form [formGroup]="form" (ngSubmit)="submitForm()">
                <div class="modal-body">
                    <div class="form-row">
                        <!--Icao-->
                        <div class="mb-3 col-md-12">
                            <label for="icao" class="form-label">Icao
                            </label>
                            <input type="text" class="form-control" id="icao" formControlName="icao" placeholder="Icao">

                            <div *ngIf="isCampoValido('icao')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                        <!--Day-->
                        <div class="mb-3 col-md-12">
                            <label for="day" class="form-label">day
                            </label>
                            <input type="text" class="form-control" id="day" formControlName="day" placeholder="day">

                            <div *ngIf="isCampoValido('day')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                        <!--Hour-->
                        <div class="mb-3 col-md-12">
                            <label for="Hour" class="form-label">Hour
                            </label>
                            <input type="text" class="form-control" id="Hour" formControlName="Hour" placeholder="Hour">

                            <div *ngIf="isCampoValido('Hour')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                        <!--Wind-->
                        <div class="mb-3 col-md-12">
                            <label for="wind" class="form-label">wind
                            </label>
                            <input type="text" class="form-control" id="wind" formControlName="wind" placeholder="wind">

                            <div *ngIf="isCampoValido('wind')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                        <!--infos-->
                        <div class="mb-3 col-md-12">
                            <label for="infos" class="form-label">infos
                            </label>
                            <input type="text" class="form-control" id="infos" formControlName="infos"
                                placeholder="infos">

                            <div *ngIf="isCampoValido('infos')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                        <!--temp-->
                        <div class="mb-3 col-md-12">
                            <label for="temp" class="form-label">temp
                            </label>
                            <input type="text" class="form-control" id="temp" formControlName="temp" placeholder="temp">

                            <div *ngIf="isCampoValido('temp')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                        <!--dew_point-->
                        <div class="mb-3 col-md-6">
                            <label class="form-label" for="dew_point">dew_point
                            </label>
                            <input class="form-control" type="datetime-local" id="dew_point"
                                formControlName="dew_point">
                            <div *ngIf="isCampoValido('dew_point')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                        <!--qnh-->
                        <div class="mb-3 col-md-6">
                            <label class="form-label" for="dew_point">qnh
                            </label>
                            <input class="form-control" type="datetime-local" id="qnh" formControlName="qnh">
                            <div *ngIf="isCampoValido('qnh')" class="text-danger">
                                Campo Obrigatório
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-bs-dismiss="modal" (click)="closeModal()">Close
                    </button>
                    <button class="btn btn-success" type="submit">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL DE VISUALIZAR TAREFA -->
<div class="modal fade" id="metarModal" tabindex="-1" role="dialog" aria-labelledby="view" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="View">
                    Datelhes da Tarefa
                </h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    &times;
                </button>
            </div>
            <div class="modal-body">
                <p> <strong>Icao: </strong>
                    {{ metarView?.icao }}
                </p>
                <p> <strong>Descrição: </strong>
                    {{ metarView?.day }}
                </p>
                <p> <strong>Status: </strong>
                    {{ metarView?.hour }}
                </p>
                <p> <strong>Data Inicio: </strong>
                    {{ metarView?.wind }}
                </p>
                <p> <strong>Data Conclusão: </strong>
                    {{ metarView?.infos }}
                </p>
                <p> <strong>Data Conclusão: </strong>
                    {{ metarView?.temp }}
                </p>
                <p> <strong>Data Conclusão: </strong>
                    {{ metarView?.dew_point }}
                </p>
                <p> <strong>Data Conclusão: </strong>
                    {{ metarView?.qnh }}
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" type="button" data-dismiss="modal">Close
                </button>
            </div>
        </div>
    </div>
</div>